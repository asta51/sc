import random
import matplotlib.pyplot as plt

f = lambda x: -x**2 + 6*x + 9
init = lambda n,l,u: [random.uniform(l,u) for _ in range(n)]

def sel(pop):
    fit=[f(x) for x in pop]
    tot=sum(fit)
    return random.choices(pop, weights=[x/tot for x in fit], k=2)

def cross(a,b): return ((a+b)/2,(a+b)/2) if random.random()<0.7 else (a,b)
def mut(x): return x+random.uniform(-1,1) if random.random()<0.01 else x

def GA(gen,pop_n,l,u):
    pop=init(pop_n,l,u);hist=[]
    for g in range(gen):
        new=[]
        while len(new)<pop_n:
            p1,p2=sel(pop)
            c1,c2=cross(p1,p2)
            new+=[mut(c1),mut(c2)]
        pop=new[:pop_n]
        best=max(pop,key=f);hist.append(f(best))
        print(f"Gen {g+1}: Best={round(best,4)}, Fit={round(f(best),4)}")
    return best,hist

if __name__=="__main__":
    best,hist=GA(50,100,-10,10)
    print(f"\nBest x={round(best,4)}, Fitness={round(f(best),4)}")
    plt.plot(hist,'bo-',label='Best Fitness');plt.title("GA Fitness Over Generations")
    plt.xlabel("Generation");plt.ylabel("Best Fitness");plt.grid(True);plt.legend();plt.show()
